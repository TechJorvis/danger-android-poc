name: Android CI

on:
    push:
        branches:
            - main
    
    pull_request:
        branches:
            - main

jobs:
    build:
        runs-on: ubuntu-latest
        
        defaults:
          run:
            working-directory: ./Danger
        
        steps:
          - name: Checkout
            uses: actions/checkout@v2.4.0
          
          - name: Setup JDK
            uses: actions/setup-java@v1
            with:
              java-version: 11
        
          - name: Set execution flag for gradlew
            run: chmod +x gradlew
   
          - name: Build with Gradle
            run: ./gradlew build
    
    sanityCheck:
      runs-on: ubuntu-latest

      defaults:
          run:
            working-directory: ./Danger
      
      steps:
        - uses: actions/checkout@master
        
        - name: Use Node.js 12.x
          uses: actions/setup-node@v1
          with:
            node-version: 12.x
        
        - name: yarn install
          run: yarn install
    
        - name: Danger
          run: yarn danger ci
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
